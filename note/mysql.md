MySQL数据库复习记录点

RDBMS--> relationship database manager system

列出库：show databases;
切换库：use database;
列出当前库的表：show tables;

创建库：create database dbname;
删除库：drop database dbname;

创建表：create table tbname(
字段 数据类型（约束宽度） 约束条件，
字段 数据类型（约束宽度） 约束条件，
字段 数据类型（约束宽度） 约束条件，
);
删除表：drop table tbname;

删除表中的所有数据：delete from tbname;
写入数据：insert into tbname([字段名]) values (value1),(value2)...;
更新数据：update tbname set 字段名='value' where 条件;

修改表结构：
增加字段：alter table tbname add 字段1 数据类型（约束宽度） 约束条件，add 字段2 数据类型（宽度） 约束条件..;
增加在第一列：alter table tbname add 字段1 数据类型（宽度） 约束条件 first;
增加在指定位置：alter table tbname add 字段1 数据类型（宽度） 约束条件 after 指定字段;
修改已有字段名：alter table tbname change 原字段名 新字段名 数据类型（宽度） 约束条件;
修改已有字段约束：alter table tbname modify 字段名 新约束条件;

#change和modify，修改已有字段名的时候必须要用change，modify报语法错误，如果是修改已有字段的约束条件
则change和modify的功能一样，语法上change多了一个保留的列名，故默认修改字段名时用change，修改约束条件
时用modify

索引
优点：加快查询速度
缺点：减慢写入速度，占用磁盘空间
                                                                            |-有关于存储数据的信息
                                                                |-元数据   -|-数据库名、表名、列的类型、访问权限
                                                                |           |-该信息的其他数据（数据字典、系统目录）
            |-information_schema   -|-提供了访问元数据的方式   -|-是个内存数据库，没有对应的磁盘文件
            |                                                   |-MySQL服务维护的信息
            |                       |-核心数据库
            |-mysql                -|-负责存储数据库的用户、权限设置、关键字等mysql自己需要使用的控制和管理信息。 
            |                       |-不可以删除
MySQL默认库-|
            |-performance_schema   -|-收集MySQL服务器性能参数
            |-sys                  -|-系统数据库，快速了解系统元数据信息




                                    |-一个表中可以有多个index字段
                                    |-字段的值允许重复，且可以赋NULL值
         |--INDEX       --普通索引--|
         |                          |-把常作为查询条件的字段做成index索引
         |                          |-KEY标志是MUL
         |
         |                          |-一个表中可以有多个unique字段
         |                          |-字段的值不允许重复，但可以赋NULL值
         |--UNIQUE      --唯一索引--|
         |                          |-把常作为查询条件的字段做成unique索引
         |                          |-KEY标志是UNI
         |
         |                          |-仅应用于myisam表
键值类型-|--FULLTEXT    --全文索引--|-用于全文搜索，一般使用Sphinx替代
         |                          |-可以提高全文搜索的效率
         |
         |                          |-提高查询效率，且提供唯一性约束
         |                          |-一张表中只能有一个主键，KEY标志是PRI
         |--PRIMARY KEY --主键    --|-一般与auto_increment连用，被标记自增的一定是主键，但主键不一定自增
         |                          |-字段值不能重复且不能为空，一般放在无意义的字段
         |                          |-主键的类型最好是数值
         |                          
         |                          |-提高查询效率
         |                          |-对应其他表的主键
         |--FOREIGN KEY --外键    --|-KEY标志是MUL
                                    |-外键的效率不好，但用的是保持数据一致性的思想
@                                   |-应用于innodb表

---------------------------------------------------------------------------------------------------------

查询条件：

            |-数字类型:= != > >= < <=
            |
            |           |- = !=（符号右边需要用双引号括起来）
            |-字符类型--|
            |           |-is null ; is not null(空和非空)
            |
            |           |-and 与
            |           |-or  或
基础条件  --|-逻辑比较--|
            |           |-not ！非
            |           |-()提高优先级
            |
            |           |-in、not in
            |-范围内  --|-between..and..
                        |-distinct （去掉重复） select distinct name from stu_table

                            |-_匹配单个字符
            |-模糊匹配(字符)|
            |               |-%匹配0个或多个字符(%可以匹配空白字符,但是不能匹配null)
            |
            |               |-^ -|
            |               |-$ -|  
            |-正则表达式  --|-. -|--正则元字符
高级条件  --|               |-[]-|
            |               |-* -|
            |
            |               |-+-*/(加减乘除)
            |-四则运算(数字)|
                            |-%(取余)
           
--------------------------------------------------------------------------------------------------------
过滤结果：
                            |-avg()
                            |-sum()
            |-聚集函数    --|-min()
            |               |-max()
            |               |-count()
            |
            |-排序        --|-order by 字段名 asc|desc
查询结果操作|
            |-分组        --|-group by 字段名
            |
            |-过滤        --|-HAVING 条件表达式
            |
            |-限制行号    --|-limit

--------------------------------------------------------------------------------------------------------
MySQL存储引擎：InnoDB MRG_MYISAM MEMORY BLACKHOLE MyISAM CSV ARCHIVE PERFORMANCE_SCHEMA FEDERATED





                                    |-frm文件---表结构
                        |-存储结构--|-MYI文件---索引信息
                        |           |-MYD文件---数据
                        |
                        |-存储方式--|-表文件独立存储
                        |
                        |           |-不支持外键
                        |-功能    --|-不支持事务
                        |           |-不支持事务回滚
            |-MYISAM  --|
            |           |-锁      --|-表级锁
            |           |
            |           |-应用    --|-查询操作多的表，直接锁整张表，节约CPU资源
常用引擎  --|
            |                       |-frm文件---表结构
            |           |-存储结构--|           |-数据
            |           |           |-ibd文件---|
            |           |                       |-索引信息
            |           |
            |           |                           |-某一个数据库所有的表数据、表索引全部存放在一个文件中，默认文件名ibdata1,10M
            |           |                           |       |-可以将表空间分成多个文件存放到各个磁盘
            |           |           |-共享表空间  --|-优点--|-表空间文件不受大小限制，一个表的表空间可以分布在不用文件上
            |           |           |               |       |-数据和文件放在一起，方便管理
            |           |           |               |
            |           |           |               |       |-所有数据和索引放到同一个文件上
            |           |           |               |-缺点--|-虽然可以把一个大文件拆分成多个小文件，但是多个表数据及索引在多个文件中易混淆
            |           |           |                       |-对于一个这样的表做大量删除操作以后表空间会有大量空隙，特别是统计分析,日值系统这类最不适用共享表空间
            |           |           |
            |           |-存储方式--|-MySQL5.6.5之前的版本默认采用共享表空间，控制参数是innodb_file_per_table，相比之下，独立表空间的性能好一些
            |           |           |               |
            |           |           |               |-每个表以独立的方式存储表数据和索引，表空间文件是.frm文件，表数据是.ibd文件
            |           |           |               |       |-每个表都有自己独立的表空间
            |           |           |               |       |-每个表的表数据和表索引都会放在自己的表空间中
            |           |           |-独立表空间  --|-优点--|-可以实现单表在不同的数据库间移动
            |           |                           |       |                                       |-Drop table自动回收，对于统计分析或是日值表，删除大量数据后可以通过:alter table TableName engine=innodb;回缩不用的空间
            |           |                           |       |-空间可以回收（除drop table操作外）  --|-对于使innodb-plugin的Innodb使用turncate table也会使空间收缩
            |           |                           |                                               |-对于使用独立表空间的表，不管怎么删除，表空间的碎片不会太严重的影响性能，而且还有机会处理
            |           |                           |       |-表空间文件无法刷新
            |           |                           |-缺点--|
            |           |                                   |-表空间文件过大不好处理
            |           |           
            |           |           |-支持外键
            |           |-功能    --|-支持事务
            |-INNODB  --|           |-支持事务回滚
                        |
                        |-锁      --|-行级锁
                        |
                        |-应用    --|-写操作多的表，降低并发写入磁盘的等待时间


                                    |-行级锁-一行数据
                         |-锁粒度 --|-表级锁-整张表
                         |          |-页级锁-内存里1M的数据
锁：解决并发访问冲突问题-|
                         |          |-读锁--|-select  --|-共享锁
                         |-锁类型 --|
                                    |       |-insert  --|
                                    |-写锁--|-update  --|-排他锁
                                            |-delete  --|


事务    ：一次sql操作从开始到结尾的过程
事务回滚：在事务执行过程中，任意一步操作失败，恢复之前所有的操作
事务日志：记录所有的sql操作

            |-原子性：事务的整个操作是一个整体，不可分割，要么成功，要么失败
            |-一致性：事务操作的前后，表中记录没有变化
事务特性  --|
            |-隔离性：事务的操作是相互隔离不受影响的
            |-永久性：数据一旦提交，不可改变，永久性的改变数据

事务是一个过程，有时间线的，MySQL默认开启自动提交，关闭自动提交后可以查看事务执行过程

            |-ib_logfile0 --|
            |               |-已经提交的sql命令
事务日志  --|-ib_logfile1 --|
            |
            |               |-未提交的sql命令（可以回滚）
            |-ibdata1     --|
                            |-LSN日志序列号
                            
-----------------------------------------------------------------------------------------

复制表的操作以后不会复制源表的索引
复制表结构的原理是在查询源表的时候加一个永假条件create table db2.t1 select * from db1.t1 where 1=2;

--------------------------------------------------------------------------------------------------

数据库备份

        |-策略     -|-完整（周、月）、增量（日、时）
        |-时间     -|-晚上（服务器压力小，读写频率低）
备份问题|-频率     -|-根据数据量
        |-文件名   -|-日期、时间
        |-存储空间 -|-可扩展（raid、lvm）


                    |-cp   -|
        |-物理备份--|-zip  -|-直接处理磁盘文件--|-小量数据，myisam存储引擎
        |           |-tar  -|
备份方式|
        |           |mysqldump -|
        |-逻辑备份--|           |-做备份时将创建库、表、操作数据的sql命令存储到一个文件中
                    |mysql     -|


                                |-all      -|
        |-所有数据--|-完整备份--|-one db   -|-mysqldump、mysql
        |                       |-one table-|
备份策略|
        |                                       |-节约空间，速度快         -|
        |           |-增量备份--|-参照上次备份--|                           |-binlog日志、innobackupex
        |           |                           |-冗余性差，丢失一个则完蛋 -|
        |-新增数据--|
                    |                           |-冗余性好，仅剩余最近一次备份即可
                    |-差异备份--|-参照完整备份--|
                                                |-浪费存储空间，数据量大的时候耗时
        
       
binlog日志：记录除查询操作外的sql命令的二进制日志

            |-statement-|-每条修改数据的sql命令都会记录
binlog日志--|-row      -|-不记录sql语句的上下文信息
            |-mixed    -|-混合使用

刷新binlog日志的方法：重启服务、flush logs
binlog日志启用则为增量备份

XtraDB是percona开发的适用于生产环境的在线热备引擎，可以理解为增强版的InnoDB

            |-在线热备份工具，不锁表，适合生产环境
XtraBackup--| |-xtrabackup-C程序，支持InnoDB、XtraDB，可以执行完整备份和增量备份
            |-|              |-以perl语言封装的xtrabackup
              |-innobackupex-|-支持InnoDB、XtraDB引擎，可以执行完整备份和增量备份
                             |-可以支持MyISAM引擎，但是每次备份都是完整备份，不支持增量备份

                                            |-ib_logfile0  -|
                |-innodb/xtradb-|-事务日志 -|-ib_logfile1  -|-以提交的sql命令
                |                           |-ibdata1      -|-未提交的sql命令和日志序列号LSN
innobackupex   -|
                |               |-xtrabackup_binlog_info   -|-当前备份的binlog日志文件和结束位置
                |               |-xtrabackup_checkpoints   -|-当前备份的日志序列号范围
                |-完整增量备份 -|-ibdata1                  -|-当前日志序列号范围内未执行的sql命令（binary）
                                |-xtrabackup_info          -|-当前备份执行时的参数信息
                                |-xtrabackup_logfile       -|-当前日志序列号范围内已执行的sql命令（binary）
                                |-backup_my.cnf            -|-执行备份的时候系统资源参数




注：1、innodb引擎不适合物理备份，因为innodb引擎存储对数据处理分为数据和事务日志两部分，只备份数据有可能会
造成事务日志紊乱的情况
    2、生产环境下备份数据的方法是计划任务+脚本、搭建MySQL主从同步
    3、生产环境最常用的是完整备份+增量备份
    4、为什么有时候设置了binlog日志的大小不管用，因为在处理大事务的时候所有日志会写入到同一个binlog日志中

---------------------------------------------------------------------------------------------------------
MySQL主从同步

                                                    |-启动binlog日志
            |-主库master   -|-被客户端访问的数据库 -|-用户授权（slaveuser-replication slave）
            |                                       |-查看正在使用的binlog日志
主从同步  --|
            |                                       |-验证主库授权用户
            |                                       |-指定server_id
            |-从库slave    -|-同步主的数据到本机   -|               |-change master to
                                                    |               |-master_host='master_ip',
                                                    |               |-master_user='slaveusername'
                                                    |-指定主库信息 -|-master_password='slaveuserpassword',
                                                    |               |-master_log_file='master_log',
                                                    |               |-master_log_pos=master_log_num;
                                                    |-查看从库状态

        |-Slave_IO_Running -|-复制主库binlog日志文件里的sql命令到本机的relay-log中
工作原理|
        |-Slave_SQL_Running-|-执行本机relay-log中的sql命令，重现master的数据操作记录
                
                |-master.info              -|-主库的连接信息
                |-relay-log.info           -|-从库的relay编号、偏移量、主库数据来源、位置
从库新增文件   -|
                |-mariadb-relay-bin.index  -|-中继日志索引
                |-mariadb-relay-bin.000000 -|-中继日志 -|-和主库binlog日志相同的sql命令
临时停止同步：stop slave；
永久停止同步：reset slave；
从库的SQL线程执行本机的中继日志里边的sql命令不会被记录到本机的binlog日志
                            
                            |-基础 -|-一主一从 -|-单点故障
                |-结构模式 -|
                |           |       |-一主多从 -|-防止了单点从
                |           |-扩展 -|-互为主从
                |                   |-链式复制 -|-log_slave_updates
                |           
                |                           |-不关心从库
主从同步模式   -|           |-异步复制     -|
                |           |               |-主库执行完sql命令后直接把结果返回给client
                |           |
                |           |               |-等待所有从库完成事务
                |-复制模式 -|-全同步复制   -|
                            |               |-然后把sql命令执行结果返回给client
                            |   
                            |               |-至少一个从库
                            |-半同步复制   -|-执行完IO线程，即将主库的sql拷贝到本机的relay_log中
                                            |-此时把sql命令执行结果返回改client

-------------------------------------------------------------------------------------------------
MySQL工作原理

                |-管理工具 -|-MySQL服务安装后提供的命令
                |               
                |           |-验证连接
                |-连接池   -|-检测空闲线程
                |           |-检测是否有硬件资源供线程使用
                |           
                |-SQL接口  -|-把sql命令提交给MySQL进程处理
                |
MySQL工作原理  -|-分析器   -|-检测sql命令是否有语法错误
                |           
                |           |-优化sql命令
                |-优化器   -|-效果最明显体现于查询sql命令
                |           |-以最节约系统资源的方式执行sql命令
                |
                |           |-用于缓存查询结果
                |-查询缓存 -|
                |           |-缓存空间是从物理内存中划分出来的
                |
                |-存储引擎 -|-表的处理器
                |
                |-文件系统 -|-存储数据的磁盘

                                        |-分析器   -|-优化器-存储引擎-文件系统
MySQL执行过程  -|-客户端--连接/线程处理-|   ||      
                                        |-查询缓存
------------------------------------------------------------------------------------------------
MySQL日志
日志是MySQL服务的重要组成部分，记录了MySQL服务运行期间发生的变化
用来记录MySQL客户端的连接情况、sql命令执行情况，和错误信息等
当数据库服务出现意外损坏时，可以通过日志查看原因，可以通过日志恢复数据
            
                        |-变量名   -|-log_error
            |-错误日志 -|-默认开启，且无法关闭，但是可以配置
            |           |-可以通过log_error定义错误日志存储位置
            |           |-log_warings定义是否将警告信息也写入错误日志
            |           |           |-服务开启、关闭过程的信息（未必是错误信息）   -|
            |           |           |-服务运行过程中的错误信息                     -|       |-5.7之前，可以直接执行mysqladmin -uroot -p123456 flush-logs冲洗日志
            |           |-记录内容 -|                                               |-应用 -|
            |                       |-事务调度的时候产生的调度信息                 -|       |-5.7之后，需要删除旧日志之后，在执行flush-logs的命令
            |                       |-从服务器启动服务的时候的信息                 -|
            |           
            |           |-变量名   -|-general_log
            |           |-默认关闭
            |-查询日志 -|-可以用general_log_file定义文件名，默认是主机名.log
            |           |           |-记录用户所有操作 -|       |-高并发的生产环境不宜开启该日志
            |           |-记录内容 -|-增删改查的所有信息|-应用 -|-造成大量的磁盘IO从而影响MySQL的性能
            |           |           |-服务的启动信息   -|       |-多数情况下应用于MySQL服务调试
            |           |           
            |           |           |-file -|-输出位置可以同时定义
            |           |-日志输出 -|-table-|
            |                       |
            |                       |-none -|-开启日志但是不记录
            |
            |           |-变量名   -|-slow_query_log
            |           |-默认关闭
            |           |-仅记录查询select命令
MySQL日志  -|-慢查询日志|-可以用slow_query_log_file定义文件名，默认是主机名-slow.log
            |           |           |-记录执行超过指定时间的查询语句-|      |-找出查询时间过长的sql语句，便于优化
            |           |-记录内容 -|                               -|-应用-|-一般建议开启
            |                       |-指定时间变量是long_query_time -|      |-对MySQL服务的性能几乎不影响
            |           
            |
            |           |-InnoDB引擎的特有日志 
            |           |-帮助提高事务执行的效率,默认开启
            |-事务日志 -|-可以理解为预写日志，修改数据写两次磁盘
            |           |           |-ib_logfile0  -|
            |           |-记录文件 -|-ib_logfile1  -|-已经执行成功的sql命令
            |           |           |           |-未执行的sql命令
            |           |           |-ib_data1 -|
            |           |                       |-日志执行的LSN序列号
            |           |
            |           |           |-修改数据的内存拷贝，再把修改记录写入硬盘
            |           |-执行过程 -|-采用追加方法，写日志是在磁盘一块区域内顺序IO，不是随机IO
            |                       |-事务日志持久化以后，修改的数据慢慢刷回磁盘
            |                       |-数据回刷磁盘过程中出现错误，则事务回滚到原来的状态
            |           
            |           |-变量名   -|-sql_log_bin
            |           |-也叫变更日志，默认开启，但不记录
            |-二进制日志|-不记录select命令
                        |           |-修改数据的sql命令
                        |-记录内容 -|-有可能引起数据修改的sql命令
                        |           |-并且记录了发生时间、执行时长、操作的数据等
                        |       |-log_bin指定文件名                                        -|
                        |       |               |-statement-|-每条修改数据的sql命令都会记录-|                   |-完整备份
                        |-参数 -|-binlog_format-|-row      -|-不记录sql语句的上下文信息    -|       |-数据备份 -|
                                |               |-mixed    -|-混合使用                     -|-应用 -|           |-增量备份
                                |                                                          -|       |-MySQL主从同步
                                |-sync_binlog  -|-二进制日志多久同步到磁盘                 -|
                                |-max_binlog_size   -|-单个binlog日志文件大小，默认1G      -|

------------------------------------------------------------------------------------------------------------------------------
MySQL多实例
优点：节约硬件资源，资源利用率最大化
缺点：一旦跑多实例的服务器挂了，则所有的数据库服务都无法使用了
注意：主要是多个实例的端口不能冲突，其他的比如数据库目录、socket文件位置等均不能冲突
    
-----------------------------------------------------------------------------------------------------------
MySQL高可用集群：

                        |-Master-Master Replication Manager For MySQL
                        |-perl语言编写，一套集合的脚本套件
                        |           |-mmm_mond      监控进程，负责所有的监控工作，决定和处理所有节点的角色活动，运行于manager节点
                |-MMM  -|-工作原理 -|-mmm_agentd    代理进程，完成监控的探针工作和执行简单的远程服务配置，运行于各个数据库节点
                |       |           |-mmm_control   一个简单的脚本，提供管理mmm_mond进程的命令
                |       |
                |       |           |-monitor端会提供多个虚拟IP（VIP），包括一个写VIP，多个读VIP，通过设置，把VIP绑定当数据库节点，一旦该节点宕机，VIP漂移到其他可用的节点上
                |       |-运行过程 -|
                |       |           |-对于mmm_mond和mmm_agentd分别授权对应的用户，如果需要使用mmm提供的备份工具还需要授权mmm_tools用户
                |       |       |-产品成熟稳定
                |       |       |-核心技术是MySQL的技术，只是通过脚本来控制VIP分布
                |       |-优点 -|-安装简单、配置简单、使用简单
                |       |       |-功能强大（HA、Failover、tools套件），支持cluster模式，一个manager管理多个mmm群组
                |       |       |-扩展性好，出现故障自动切换，
                |       |       |-采用主主同步，但写操作只在一台机器上进行，保证数据一致性
                |       |
                |       |       |-Monitor是单节点，存在单点故障隐患，可以结合Keepalived实现高可用
                |       |-缺点 -|-写VIP只有一个，存在并发IO瓶颈，可以采用垂直拆分到多个mmm组的cluster模式
                |               |-读写VIP分离，对于程序员编程存在挑战，可以结合proxy、maxscale等工具
                |               |-对于机器数量有限制，最少4台机器
MySQL高可用集群-|
                |       |-Master High Availability
                |       |-perl语言编写，一套比较成熟的MySQL高可用解决方案
                |       |-在MySQL故障切换的过程中，MHA能做到在30秒内自动完成数据库的切换操作，并在该过程中最程度的保证数据一致性
                |       |           |-从宕机崩溃的master保存二进制日志事件（binlog events）
                |       |           |-识别含有最近更新的slave
                |-MHA  -|-工作原理 -|-应用差异的中继日志（relay log）到其他的slave
                        |           |-应用从master保存的二进制日志事件（binlog events）
                        |           |-提升一个slave为新的master
                        |           |-使其他的slave连接到新的master进行同步数据
                        |
                        |           |-应用基于MySQL5.5版本以上，带有半同步复制功能版本的数据库
                        |-工作过程 -|-采用一主多从的结构，主从同步的过程开启半同步复制，保证sql命令至少同步到一个slave以后再把执行结果返回给client
                        |           |-最少需要三台机器，一台主、一台备用主、一台从，目前淘宝的TMHA已经实现了一主一从结构
                        |
                        |       |-容易安装，不必更改现有的环境，适用于任何引擎
                        |       |-自动化主从服务器故障切换，30S内完成
                        |-优点 -|-不影响复制的一致性，不会有性能损耗
                        |       |-管理节点与数据库节点用过ssh协议连接通信
                        |       |-使用半同步复制，大大降低数据丢失的风险，只要有一个slave收到二进制文件，就可以应用到其他所有的slave服务器上
                        |
                        |       |-虽然视图从宕机的master保存二进制日志，如果ssh无法访问或者硬件损坏，数据就会丢失
                        |-缺点 -|-先前宕机的master修复好以后不能立即加入MHA系统，需要重新部署
                                |-master发生故障的时候监控进程会自动退出，修复以后需要手动重启进程
                                |-机器数量受限制，最少三台
                                |-故障修复操作复杂
----------------------------------------------------------------------------------------------------------------------------------------------------
MySQL视图
作用：为保障数据安全，向用户展示一部分数据，不展示所有数据

                    |-虚拟表(动态)
                    |-内容与真实的表相似，包含一系列带有名称行和列的数据
            |-定义 -|-视图在数据库中并不以存储的形式存在
            |       |-行和列的数据来自定义视图时查询所引用的基表，并且在具体引用视图时动态生成
            |       |-更新视图的数据基表数据也会更新，更新基表数据视图会随着更新
            |                   |-用户不关心视图中的数据如何查询获得
            |       |-简单     -|
            |       |           |-视图中的数据是已经过滤好符合条件的结果集
            |       |
MySQL视图  -|-优点 -|-安全     -|-用户只能看到视图中的数据
            |       |           
            |       |-数据独立 -|-一旦视图结构确定，可以屏蔽表结构对用户的影响
            |           |-不能在视图上创建索引
            |-使用限制 -|-在视图的from子句中不能使用子查询
            |           |                   |-包含以下聚合函数的sql语句：sum、min、max、count、group by等
            |           |                   |-常量视图：join、from一个不能更新的视图
            |           |-不更新视图情况   -|
            |           |                   |-where子句的子查询引用了from子句中的表
            |           |                   |-使用了临时表
            |
            |                       |-create view v1 as sql查询;           -|-默认字段名与基表一致
            |           |-创建视图 -|
            |           |           |-create view v2(字段名) as sql查询;   -|-重命名字段名，注意保持字段数一致
            |           |               |-查看磁盘文件，没有.ibd表空间文件只有.frm的是视图表
            |-基本使用 -|-区分视图与表 -|
            |           |               |-show table status;显示comment是view的是视图表
            |           |           |-增:insert into viewname values:向视图内写入的时候基表多余字段用NULL补全
            |           |           |-删:delete from viewname where
            |           |-操作视图 -|-删除视图:drop view viewname:删除视图与基表数据无关
            |           |           |-改:update viewname set 
            |           |           |-查:select * from viewname
            |
            |           |-字段名别名 as
            |           |-替换原有视图 or replace
            |-高级应用 -|           |-MERAGE   -|-视图名直接用视图的公式替换，把视图公式合并到了select中
                        |-ALGORITHM-|-TEMPTABLE-|-先执行视图得到结果，然后把结果暂时保存在内存中，然后外层select调用内存中的结果
                        |           |-UNDEFINED-|-表示默认使用MERAGE
                        |
                        |           |-WITH CHECK OPTION
                        |-检查方式 -|-LOCAL：仅检查当前视图的限制
                                    |-CASCADED：同时要满足基表的限制(默认)
--------------------------------------------------------------------------------------------------------------------------------
MySQL存储过程

                        |-MySQL语句组成的脚本
                |-定义 -|-数据库中保存的一些列sql命令的集合
                |       |-可以存储过程中使用变量、条件判断、流程控制等
                |
                |       |-提高性能
                |       |-减轻网络负担
MySQL存储过程  -|-优点 -|
                |       |-避免直接访问表
                |       |-避免重复编写sql操作
                |-存储位置 -|-mysql.proc
                |-查看过程 -|-show procedure status
                |-创建 -|-create procedure name() begin ... end
                |-调用 -|-call name
                |-删除 -|-drop procedure name   （不需要带括号）
                |           |-会话变量：影响当前会话   -|
                |           |-全局变量：影响服务器全局 -|-统称系统变量，用set定义
                |-变量类型 -|                                                           |-定义 set @变量名=值
                |           |-用户变量：客户端连接到服务器过程中有效，连接断开即失效   -|-输出 select @变量名
                |           |           |-定义在存储过程的begin...end字段中
                |           |-局部变量 -|-作用有效范围是该语句块执行的过程
                |                       |-用declare声明
                |           |-所有变量：show global variables
                |-查看变量 -|
                |           |-会话变量：show session variables
                |
                |           |-算术运算 -|-{+,-,*,/,DIV,%[加、减、乘、除、求模、取余]}
                |           |
                |           |           |-类似于shell脚本中的位置变量
                |           |           |-in：调用存储过程时给存储过程传值，必须在调用时赋值，且执行存储过程时不允许改变
                |           |-参数类型 -|-out：该值可在存储过程中被改变，且能返回，传参的时候用变量
                |           |           |-inout：调用时指定，且可改变可返回
                |           |           |-注意：变量名与被查询表字段名不能一致，否则会返回每一行的数据
                |           |
                |           |           |-条件判断结果最为流程控制的条件
                |-变量操作 -|-条件判断 -|-数值比较{=,>=,<=,!=,<,>,between..and..}
                            |           |-逻辑比较{or,and,!,is null,is not null,in,not in,like,regexp}
                            |           
                            |           |-if条件then命令end if;
                            |           |-if条件then命令else命令end if;
                            |-流程控制 -|-while：条件成立时执行代码块-while：条件成立时执行代码块
                            |           |-while：条件成立时执行代码块
                            |           |-repeat：条件成立是结束循环,until后边不需要;
                            |
                            |           |-leave：终止当前循环，作用等同于shell的break
                            |-循环控制 -|-注意创建标签名
                                        |-iterate：跳过本次循环，作用等同于shell的continue
---------------------------------------------------------------------------------------------------------------------------
MySQL存储过程与函数
procedure & function（本质上都是过程控制，堆叠SQL代码）

                                |-function，必须有返回值，有且只有一个返回值，return对象供其他语句调用
                    |-return   -|
                    |           |-procedure，不必须定义return字段，可以有多个返回值
                    |
                    |           |-function，不能有select 1111
                    |-select   -|
MySQL存储过程和函数-|           |-procedure，可以有select 1111
                    |
                    |       |-function：select 函数名
                    |-调用 -|
                    |       |-procedure：call 存储过程名
                    |
                    |-默认值：set 变量名 变量类型 default 默认值
                    |
                    |           |-function：只能有in类型
                    |-参数类型 -|
                    |           |-procedure：有in、out、inout三种，默认为in
                    |
                    |       |-function：一般不作为单独个体执行，多在其他sql命令中被调用
                    |-执行 -|
                            |-procedure：多作为单独个体执行，获取执行结果
总体来说，procedure性能比较好，功能比较强大，处理的动作也更为复杂，相对比函数来说限制较少
-------------------------------------------------------------------------------------------------------------------
MySQL分库分表：缓解单台数据库服务器压力（访问、存储）过大的，防止单个表过大的问题（一张表最多存4G的数据）

            |-定义：讲存放在一个数据库（主机）中的数据，按照某种特定的方式进行拆分，分散到多个数据库主机
            |           |-水平拆分：将一个表中不同行的数据按照某种规则分散到多个库中进行存储
            |-拆分方式 -|
            |           |-垂直拆分：将一个表中不同字段的数据按照某种规则分散到多个库中进行存储
            |               |-Java开发
            |               |-支持JDBC连接
            |               |-支持MySQL、Oracle、MongoDB等
            |               |-提供数据读写分离服务
            |-MyCat-|-功能 -|-可以实现数据库服务器的高可用
            |       |       |-提供数据分片服务
分库分表   -|       |       |-基于阿里巴巴的Cobar进行研发的开源软件
            |       |       |-适合数据大量写入的存储需求
            |       |           |-枚举法sharding-by-intfile
            |       |           |-固定分片rule1
            |       |           |-范围约定auto-sharding-long
            |       |           |-求模法mod-long
            |       |           |-日期列分区法sharding-by-date
            |       |-分片规则 -|
            |       |           |-通配取模sharding-by-pattern
            |       |           |-ASCII码求模通配sharding-by-perpattern
            |       |           |-编程指定sharding-by-substring
            |       |           |-字符拆分hash解析shard-by-stringhash
            |       |           |-一致性hash sharding-by-murmur
            |       |       |-定义数据分片规则
            |       |       |-接受客户端请求
            |       |-作用 -|-写操作按照分片规则处理数据
            |       |       |-记录数据存储位置
            |       |       |-读操作整合后台数据
            |       |       |-处理结果返还客户端
            |       |           |-bin：启动程序
            |       |           |                   |-rule.xml：分片规则
            |       |           |-conf：配置文件   -|-server.xml：设置连接mycat的用户密码等
            |       |           |                   |-schema.xml：设置后端数据库
            |       |           |-catlet：插件程序
            |       |-目录结构 -|
            |       |           |-lib：库文件，jar库
            |       |           |-logs：日志文件
            |       |           |-version：版本信息
